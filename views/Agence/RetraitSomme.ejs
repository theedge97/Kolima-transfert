<!-- debut de head-->
<%- include('head'); -%>


<title>Retrait  || Agence Kolima  Transfert</title>
<style>
  #carte{
    display: none;
  }
  .error
  {
      color: red;
  }
  #lespiner{
            position: fixed;
            top: 60%;
            left: 47%;
            z-index: 10000;
            display: none;
        }
</style>
  <!-- fin de head-->
 
</head>
<script src="/assets/semantic/lib/jquery.validate.js"></script>
<script src="/assets/semantic/lib/moment.min.js"></script>

<script src="/assets/semantic/lib/html2pdf.bundle.min.js"></script>
<script src="/assets/semantic/js/jquery.formatCurrency.js" ></script>
<script src="/assets/semantic/js/easy-number-separator.js"></script>


<!-- debut  de menue-->
<%- include('menue'); -%>
    <!--fin de menue end-->
    <!-- **********************************************************************************************************************************************************
        MAIN CONTENT
        *********************************************************************************************************************************************************** -->
    <!-- debut du body-->
    <section id="main-content">
      <section class="wrapper">
      
        <div class="row mt-5">
         
            <div class="col-lg-12  ">
             
              <div class="row account-contant">
                <div class="col-12" id="lespiner">
                  <div style=" height: 3rem;"  class="d-flex align-items-center">
                    <strong style="color: #4ECDC4;" class="">Chargement...</strong><br>
                    <div class="spinner-border  ms-1"  style="color: #4ECDC4;" role="status" aria-hidden="true"></div>
                  </div>
                 </div>          
                <div class="col-12">
                    <div class="card card-statistics">
                        <div class="card-body p-0">
                            <div class="row no-gutters">
                                
                                <div class="col-xl-12 col-md-12 col-12">
                                    <div class="page-account-form">
                                        <div class="form-titel border-bottom p-3">
                                            <h5 class="mb-0  textcoleur py-2">Retrait d'Argent     </h5>
                                            <!--Boite Modale d erreur Taux -->
                                            <div id="codeerreurs" class="modal" tabindex="-1">
                                              <div class="modal-dialog">
                                                <div class="modal-content">
                                                  <div class="modal-header bg-danger">
                                                    <h5 class="modal-title">Erreur de  Code...!!</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                  </div>
                                                  <div class="modal-body">
                                                    <p>Votre code ne correspond pas . Veuillez Bien verifier votre code .....!!  . </p>
                                                  </div>
                                                 
                                                </div>
                                              </div>
                                            </div>

                                               <!--Confirmation de Validation de Code -->
                                            
                                              <div id="validertransaction" class="modal" tabindex="-1">
                                                <div class="modal-dialog">
                                                  <div class="modal-content">
                                                    <div class="modal-header bg-success">
                                                      <h5 class="modal-title">Transaction validée...!!</h5>
                                                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                      <p>La  transaction a été  Validé  . </p>
                                                    </div>
                                                   
                                                  </div>
                                                </div>
                                              </div>
                                              <!--Fin de Validation -->
                                            

                                            <!--Fin Boite Modale -->
                                            <!--Boite modale invalide Code -->
                                            <div id="invalidecode" class="modal" tabindex="-1">
                                              <div class="modal-dialog">
                                                <div class="modal-content">
                                                  <div class="modal-header bg-warning">
                                                    <h5 class="modal-title">invalide  Code ...!!</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                  </div>
                                                  <div class="modal-body">
                                                    <p>Votre est invalide ou Expirer. </p>
                                                  </div>
                                                 
                                                </div>
                                              </div>
                                            </div>
                                            <!--Fin Boite Modale-->
                                             <!--BOite modale Imprimer Facture du Client -->

  <!-- Modal -->
 
  <!-- Modal -->
  <div class="modal  fade" id="facture" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable  modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title text-dark" id="exampleModalLabel">Génération de la Facture de  Retrait</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-dark" id="facturereception" >
           <div>
            <div class="row">
              <div class="col-lg-6 col-sm-6">
                <span id="envoiedate"></span> 
              </div>
            <div class="col-lg-6 col-sm-6 text-rigth">
              <span >Reçus de Reception </span>
            </div>
            </div>
            <div class="row border pb-2 pe-2 ps-2 m-1 rounded-2">
             <h3 class="text-center">Kolima Transfert</h3>
             <p class="text-center">Reçu de Reception </p>
             <p id="envoieagence">Agence : <span id="nomagence"></span></p>
             <div class="row border pb-2 pe-2 ps-2 m-1 rounded-2">
               <h4>Envoyeur</h4>
               <div class="col-lg-12">
                  <p><span>Pays : <span id="envoiepaysenvoie"></span></span><span> Téléphone : <span id="envoietelephoneenvoyeur"></span></span></p>
                  <p>Nom et Prenom : <span id="envoienomenvoyeur"> </span></p>
                  <p><span>Type de pièce : <span id="envoietypepiece">Ci</span> </span> <span>Numéro de la pièce : <span id="envoienumpiece"></span></span></p>
                </div>
             </div>
  
             <div class="row border pb-2 pe-2 ps-2 m-1 rounded-2">
              <h4>Bénéficiaire</h4>
              <div class="col-lg-12">
                 <p><span>Pays : <span id="envoiepaysbenef"></span></span><span> Téléphone : <span id="envoietelephonebenef"></span></span></p>
                 <p>Nom et Prenom : <span id="envoienombenef"> </span></p>
                 </div>
            </div>
            
            <div class="row border pb-2 pe-2 ps-2 m-1 rounded-2">
              <h4>Transaction </h4>
              <div class="col-lg-12">
                 <p><span>Code D'envoie  : <span id="envoiecode"></span></span></p>
                 <p>Numéro  : <span id="envoieidtransac"> </span></p>
                 <p><span>Montant Envoyé  : <span id="envoiemontanenvoyer"></span> </span> <span id="lamonaie"> </span></p>
                <p>Commissions TTC : <span id="envoiecomission"></span> <span id="envoiecomissionmonaie"></span></p>
                <p>Total :  <span id="envoiesommetotal"></span> <span id="totalmonaie"></span></p>
                <p>Montant à recevoir par le Bénéficiaire :  <span id="envoiemontantbenef">  </span> <span id="envoiemonaiebenf"></span></p>
                </div>
            </div>
            <hr class="mt-4">
            <div class="row">
              <div class="col-lg-6 col-sm-6">
                   Caissier
              </div>
              <div class="col-lg-6 col-sm-6 text-right">
                Client
              </div>
  
            </div>
  
                   
  
             </div>
           </div>
          -------------------------------------------------------------------------------------------------------------------------------------------------------
           <div>
            <div class="row">
              <div class="col-lg-6 col-sm-6">
                <span id="envoiedate1"></span> 
              </div>
            <div class="col-lg-6 col-sm-6  text-rigth">
              <span>Reçus de Reception  </span>
            </div>
            </div>
            <div class="row border pb-5 pe-5 ps-5 m-1 rounded-2">
             <h3 class="text-center">Kolima Transfert</h3>
             <p class="text-center">Reçu de Reception </p>
             <p id="envoieagence1">Agence : <span id="nomagence1"></span></p>
             <div class="row border pb-2 pe-2 ps-2 m-1 rounded-2">
               <h4>Envoyeur</h4>
               <div class="col-lg-12">
                  <p><span>Pays : <span id="envoiepaysenvoie1"></span></span><span> Téléphone : <span id="envoietelephoneenvoyeur1"></span></span></p>
                  <p>Nom et Prenom : <span id="envoienomenvoyeur1"> </span></p>
                  <p><span>Type de pièce : <span id="envoietypepiece1">Ci</span> </span> <span>Numero de la pièce : <span id="envoienumpiece1"> </span></span></p>
                </div>
             </div>
  
             <div class="row border pb-2 pe-2 ps-2 m-1 rounded-2">
              <h4>Bénéficiaire</h4>
              <div class="col-lg-12">
                 <p><span>Pays : <span id="envoiepaysbenef1"></span></span><span> Téléphone : <span id="envoietelephonebenef1"></span></span></p>
                 <p>Nom et Prenom : <span id="envoienombenef1"> </span></p>
                 </div>
            </div>
            
            <div class="row border pb-2 pe-2 ps-2 m-1 rounded-2">
              <h4>Transaction </h4>
              <div class="col-lg-12">
                 <p><span>Code D'envoie  : <span id="envoiecode1"></span></span></p>
                 <p>Numéro  : <span id="envoieidtransac1"> </span></p>
                 <p><span>Montant Envoyé  : <span id="envoiemontanenvoyer1"></span> </span> <span id="lamonaie1"> </span></p>
                <p>Commissions TTC : <span id="envoiecomission1"></span> <span id="envoiecomissionmonaie1"></span></p>
                <p>Total :  <span id="envoiesommetotal1"></span> <span id="totalmonaie1"></span></p>
                <p>Montant a recevoir par le Bénéficiaire :  <span id="envoiemontantbenef1"> <span>    <span id="nj"></span></p>
                </div>
            </div>
            <hr class="mt-1">
            <div class="row">
              <div class="col-lg-6 col-sm-6">
                Caissier 
              </div>
              <div class="col-lg-6 col-sm-6 text-right">
                Client
              </div>
  
            </div>
  
                   
  
             </div>
           </div>
           

        </div>
        
      <div class="modal-footer">
        <form method="post" id="validat" action="/Agence/code">
        <button type="button" class="btn btn-default" data-dismiss="modal"><a  href="/Agence/RetraitArgent">Fermer</a></button>
        
          <input type="hidden" name="idtransaction" id="idtransaction"  />
          <button type="button submit" id="imprimer" class="btn btn-success">Validé </button>
        </form>
      </div>
      </div>
    </div>
  </div>
  <!--Fin modale-->
        <!--Fin -->
                                             <!--Boite modale innexistance de Frais envoie erreurfrais -->
                                             <div id="validation" class="modal" tabindex="-1">
                                              <div class="modal-dialog">
                                                <div class="modal-content">
                                                  <div class="modal-header bg-success">
                                                    <h5 class="modal-title">Tansaction Validé ...!!</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                  </div>
                                                  <div class="modal-body">
                                                    <p>Votre Transaction a été validé. </p>
                                                  </div>
                                                 
                                                </div>
                                              </div>
                                            </div>
                                            <!--Fin Boite Modale-->
                                          </div>
                                        <div class="p-4">
                                            <form  id="signupForm" method="post" action="/Agence/retrait">
                                                <div class="row ">
                                                    
                                                    <div class="form-group col-md-4 col-md-offset-2">
                                                      <label for="code" class="control-label ">Veuillez entrer le code que vous avez reçus  :</label>
                                                      <input type="text" class="form-control" name="code" id="code" placeholder="Entrez le code  ">
                                                    </div>
                                               
                                                  
                                                  
                                                 
                                                    
                                                </div>
                                                <div class="form-group">
                                                  <div class="col-lg-offset-2 col-lg-9">
                                                    <button id="enregistrer" class="btn btn-primary" type="submit">Enregistrer</button>
                                                    <button id="can" class="btn btn-warning" type="button">Cancel</button>
                                                  
                                                  </div>
                                                </div>
                                            </form>
                  
                                                
                                     
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
      <!--Fin de notification d'erreur-->
     
            </div>
            <!-- /col-lg-12 -->
          </div>
          
          <!-- Button trigger modal -->

        <!-- /row -->
      </section>
    </section>
    <!--main content end-->
    
  </section>
  <!-- js placed at the end of the document so the pages load faster -->
  
  
<script>
  easyNumberSeparator({
    selector: '.number-separator',
    separator: ' ',
    resultInput: '#montant',
  })
  //
  
</script>

  <script src="/assets/semantic/lib/bootstrap/js/bootstrap.min.js"></script>
 
  <script>
 
    var nomimprimer = "";
    var idtransaction = "";
      
        $().ready(function() {
          // validate the comment form when it is submitted
          jQuery.validator.addMethod("phoneGuinee", function (phone_number, element) {
            phone_number = phone_number.replace(/\s+/g, "");
            return this.optional(element) || phone_number.length >= 9 && phone_number.match(/^6[1,2,5,6]{1}[0-9]{7}$/);
        }, "Veuillez Entrez le bon format de Numero");
          // validate signup form on keyup and submit
          $("#signupForm").validate({
            rules: {
              code: {
                required: true,
                minlength: 5
              } ,
             
            },
            messages: {
              code: {
                required: "Veuillez entrez le code .",
                minlength: "Votre code doit  être égale à 5 caractères "
              }
            },
            submitHandler: function(form){
              $("#lespiner").css({ 
                      display: 'block'
                    });
         
         $.ajax({
             url: form.action,
             type: form.method,
             data: $(form).serialize(),
             success: function(response) {
             
              $("#lespiner").css({ 
                      display: 'none'
                    });
                  if (response.codeerreurs) { 
                    $('#codeerreurs').modal('show')     
                        setTimeout(function () {
                            $('#codeerreurs').modal('hidden')
        }, 3000)
                        
                    }  
                    if (response.invalidecode) { 
                        
                        
                        $('#invalidecode').modal('show')
                        setTimeout(function () {
                            $('#invalidecode').modal('hidden')
        }, 3000)
                        
                    }
                      
                    if (response.transaction) { 
                     
                    var transaction = response.transaction;




                          
                     $("#envoienomenvoyeur").html(transaction['Nomexpediteur']);
                     $("#envoienomenvoyeur1").html(transaction['Nomexpediteur']);
                     $("#envoietelephoneenvoyeur").html(transaction['Contactexpediteur']);
                     $("#envoietelephoneenvoyeur1").html(transaction['Contactexpediteur']);
                     $("#idtransaction").val(response.transaction['idtransac']);
               
                     $("#envoiepaysenvoie").html(transaction['pays']);
                     $("#envoiepaysenvoie1").html(transaction['pays']); 
                     $("#envoiepaysbenef").html(response.paysagence);
                     
                     $("#envoiepaysbenef1").html(response.paysagence);
                      
            $('#totalmonaie').html(transaction['monaie']);
            $('#totalmonaie1').html(transaction['monaie']);
            $('#envoiecomissionmonaie').html(transaction['monaie']);
            $('#envoiecomissionmonaie1').html(transaction['monaie']);
            //lamonaie1
            $('#lamonaie').html(transaction['monaie']);
            $('#lamonaie1').html(transaction['monaie']);
                     
                     $("#envoiemonaiebenf").html(response.agencedevise);
                     $("#envoiemonaiebenf1").html(response.agencedevise);
                   
                     $("#envoienombenef1").html(transaction['Nomreceveur']);
                     $("#envoienombenef").html(transaction['Nomreceveur']);
                     $("#envoietelephonebenef").html(transaction['Contactreceveur']);  
                     $("#envoietelephonebenef1").html(transaction['Contactreceveur']);   
                     $("#envoiecode").html(transaction['Codetransfert']);
                     $("#envoiecode1").html(transaction['Codetransfert']);
                     //Envoie argent 
                     var sommeenvoie = new Intl.NumberFormat('gn-GN').format(transaction['Sommeenvoie'])
                    //asaa  Niisasa
                    var montantdevise = new Intl.NumberFormat('gn-GN').format(transaction['montantdevise'])
                     
                     $("#envoiemontanenvoyer").html(montantdevise);       
                     $("#envoiemontanenvoyer1").html(montantdevise);  
                     //Gabolo 
                     var frai = new Intl.NumberFormat('gn-GN').format(transaction['Frais'])
                     $("#envoiecomission").html(frai);
                     $("#envoiecomission1").html(frai);
                     //Frais 
                     $("#envoiesommetotal").html(sommeenvoie); 
                     $("#envoiesommetotal1").html(sommeenvoie);  

                     //Sommme envoie    
                   
                     //envoiemontantbenef1
                     var montantlocale = new Intl.NumberFormat('gn-GN').format(transaction['montantlocale'])
                    
                     $("#envoiemontantbenef").html(montantlocale);
                     $("#envoiemontantbenef1").html(montantlocale);  
                     //Nom Agence 
                     
                     $("#nomagence").html(response.nomagence); 
                     
                     $("#nomagence1").html(response.nomagence); 
                     //envoiedate
                     
                    var dateenvoie =  moment(transaction['Datetransaction']).format('DD / MM / YYYY ');
                    
                    $("#envoiedate").html(dateenvoie); 
                    
                    $("#envoiedate1").html(dateenvoie); 
                    //Envoie de la monaie 
                    //envoietelephonebenef1
                    $("#envoiedate1").html(dateenvoie); 
                

                        $('#facture').modal('show')
            $('#validation').modal('show')
                   
                  }
    
    
                 /*

                    var date = response.transaction['Datetransaction'] ;
                    var ladate =  moment(date).format('DD / MM / YYYY ');
                    var heur  =  moment(date).format(' h:mm:ss ');
                    $("#ladate").html(ladate);
                    $("#heur").html(heur);
                    $("#ag").html(response.nomagence);
                    nomimprimer = response.nomagence + ladate + heur + ".pdf"; 
                    //
                    $("#idtransaction").val(response.transaction['idtransac']);
                    
                    $("#nomexpediteur").html(response.transaction['Nomexpediteur']);
                    $("#telephoneexpediteur").html(response.transaction['Contactexpediteur']);
                    $("#nombeneficaire").html(response.transaction['Nomreceveur']);
                    $("#telephonebeneficaire").html(response.transaction['Contactreceveur']);
                    $("#cartebeneficaire").html(response.transaction['Numerocarte']);
                    $("#montantbeneficiaire").html(response.transaction['Sommeenvoie']);
                    //montantenvoie
                    $("#montantenvoie").html(response.sommes);
                    //devise 
                    $("#devise").html(response.devise);
                    


                 */
                 
                            }            
               });       
         }
         
          });
      
      
          //code to hide topic selection, disable for demo
          var newsletter = $("#newsletter");
          // newsletter topics are optional, hide at first
          var inital = newsletter.is(":checked");
          var topics = $("#newsletter_topics")[inital ? "removeClass" : "addClass"]("gray");
          var topicInputs = topics.find("input").attr("disabled", !inital);
          // show when newsletter is checked
          newsletter.click(function() {
            topics[this.checked ? "removeClass" : "addClass"]("gray");
            topicInputs.attr("disabled", !this.checked);
          });
        });
        
     document.querySelector("#imprimer").addEventListener("click", ()=>{
                const invoice = this.document.getElementById("lenvoie");
    
                     //si le compte n'est pas engistrer
              
    
                var opt = {
      margin:       0.5,
      filename:     nomimprimer,
      image:        { type: 'jpeg', quality: 0.98 },
      html2canvas:  { scale: 2 },
      jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
    };
    html2pdf().from(invoice).set(opt).save();
                
            })
    
    
         
        </script>
       <script>
       

        //Verifions
        $().ready(function() {
        // validate the comment form when it is submitted
        jQuery.validator.addMethod("phoneGuinee", function (phone_number, element) {
        phone_number = phone_number.replace(/\s+/g, "");
        return this.optional(element) || phone_number.length >= 9 && phone_number.match(/^6[1,2,5,6]{1}[0-9]{7}$/);
    }, "Veuillez Entrez le bon format de Numero");
 // add the rule here


        $("#validat").validate({

submitHandler: function(form){
     $("#lespiner").css({ 
                      display: 'block'
                    });
$.ajax({
    url: form.action,
    type: form.method,
    data: $(form).serialize(),
    success: function(response) {
     
         if (response.success) {  
            $("#validertransaction").css({ 
                      display: 'block'
                    });
                    
setTimeout(function () {
 
    $("#validertransaction").css({ 
                      display: 'none'
                    });
                  }, 3000);
           
const invoice = document.getElementById("facturereception");

var opt = {
margin:       0.5,
filename:     'receptionfacture.pdf',
image:        { type: 'jpeg', quality: 0.98 },
html2canvas:  { scale: 2 },
jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' },
pagebreak: {mode: 'avoid-all', before:'#pageX'}

};
html2pdf().from(invoice).set(opt).save();

       
setTimeout(function () {
 window.location.href = "/Agence/RetraitArgent";
                 }, 5000);
     
                 }  
         
         
        
                   }            
      });       
}
});


    
        
        //code to hide topic selection, disable for demo
        var newsletter = $("#newsletter");
        // newsletter topics are optional, hide at first
        var inital = newsletter.is(":checked");
        var topics = $("#newsletter_topics")[inital ? "removeClass" : "addClass"]("gray");
        var topicInputs = topics.find("input").attr("disabled", !inital);
        // show when newsletter is checked
        newsletter.click(function() {
            topics[this.checked ? "removeClass" : "addClass"]("gray");
            topicInputs.attr("disabled", !this.checked);
        });
    });

             
   
    
</script>

  <script class="include" type="text/javascript" src="/assets/semantic/lib/jquery.dcjqaccordion.2.7.js"></script>
  <script src="/assets/semantic/lib/jquery.scrollTo.min.js"></script>
  <script src="/assets/semantic/lib/jquery.nicescroll.js" type="text/javascript"></script>
  <script src="/assets/semantic/lib/jquery.sparkline.js"></script>
  <!--common script for all pages-->
  <script src="/assets/semantic/lib/common-scripts.js"></script>
  <script type="text/javascript" src="/assets/semantic/lib/gritter/js/jquery.gritter.js"></script>
  <script type="text/javascript" src="/assets/semantic/lib/gritter-conf.js"></script>
  <!--script for this page-->
  
  
  
</body>

</html>
