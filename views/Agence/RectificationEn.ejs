<!-- debut de head-->
<%- include('head'); -%>


<title>Agency || Kolima  Transfert</title>

  <!-- fin de head-->
  <style>
    #blockmodifier
    {
      display: none;
    }
  </style>

</head>
<script src="/assets/semantic/lib/jquery.validate.js"></script>
<script src="/assets/semantic/lib/moment.min.js"></script>

<script src="/assets/semantic/lib/html2pdf.bundle.min.js"></script>
<script src="/assets/semantic/js/jquery.formatCurrency.js" ></script>
<script src="/assets/semantic/js/easy-number-separator.js"></script>


<!-- debut  de menue-->
<%- include('menueEn'); -%>
    <!--fin de menue end-->
    <!-- **********************************************************************************************************************************************************
        MAIN CONTENT
        *********************************************************************************************************************************************************** -->
    <!-- debut du body-->
    <section id="main-content">
      <section class="wrapper">

        <div class="row mt-5">

            <div class="col-lg-12  ">

              <div class="row account-contant">

                <div class="col-12">
                    <div class="card card-statistics">
                        <div class="card-body p-0">
                            <div class="row no-gutters">

                                <div class="col-xl-12 col-md-12 col-12">
                                    <div class="page-account-form">
                                        <div class="form-titel border-bottom p-3">
                                            <h5 class="mb-0  textcoleur py-2">Edit Transaction Information.    </h5>
                                            <!--Boite Modale d erreur Taux -->
                                            <div id="valide" class="modal" tabindex="-1">
                                              <div class="modal-dialog">
                                                <div class="modal-content">
                                                  <div class="modal-header bg-success">
                                                    <h5 class="modal-title">Succes...!!</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                  </div>
                                                  <div class="modal-body">
                                                    <p>Congratulation the Information has been successfully modified.....!!  . </p>
                                                  </div>

                                                </div>
                                              </div>
                                            </div>


                                            <!--Fin Boite Modale -->
                                            <!--Boite modale invalide Code -->
                                            <div id="codeerreurs" class="modal" tabindex="-1">
                                              <div class="modal-dialog">
                                                <div class="modal-content">
                                                  <div class="modal-header bg-warning">
                                                    <h5 class="modal-title">Error Code  ...!!</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                  </div>
                                                  <div class="modal-body">
                                                    <p>Invalid Code . </p>
                                                  </div>

                                                </div>
                                              </div>
                                            </div>
                                            <!--Fin Boite Modale-->
                                             <!--BOite modale Imprimer Facture du Client -->

  <!-- Modal -->
        <!--Fin -->
                                             <!--Boite modale innexistance de Frais envoie erreurfrais -->
                                             <div id="validation" class="modal" tabindex="-1">
                                              <div class="modal-dialog">
                                                <div class="modal-content">
                                                  <div class="modal-header bg-success">
                                                    <h5 class="modal-title">Tansaction Validé ...!!</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                  </div>
                                                  <div class="modal-body">
                                                    <p>Votre Transaction a été validé. </p>
                                                  </div>

                                                </div>
                                              </div>
                                            </div>
                                            <!--Fin Boite Modale-->
                                          </div>
                                        <div class="p-4">
                                            <form  id="rectifie" method="post" action="/Agence/RectificationTransaction">
                                                <div class="row ">

                                                    <div class="form-group col-md-4 col-md-offset-2">
                                                      <label for="code" class="control-label ">Please enter the code you received  :</label>
                                                      <input type="text" class="form-control" name="code" id="code" placeholder="Entrez le code  ">
                                                    </div>





                                                </div>
                                                <div class="form-group">
                                                  <div class="col-lg-offset-2 col-lg-9">
                                                    <button id="enregistrer" class="btn btn-primary" type="submit">Enregistrer</button>
                                                    <button id="can" class="btn btn-warning" type="button">Cancel</button>

                                                  </div>
                                                </div>
                                            </form>




                                        </div>
                                        <hr>
                                        <div class="p-4" id="blockmodifier">
                                            <form id="signu" class="cmxform form-horizontal style-form" id="signupForm" method="post" action="/Agence/RectificationTransactionInfo">
                                                <div class="row ">

                                                    <div class="form-group col-md-4 col-md-offset-2">
                                                      <label for="expediteurnom" class="control-label ">Sender's Name  :</label>
                                                      <input type="text" class="form-control" name="expediteurnom" id="expediteurnom" placeholder="Enter the Sender Name  ">
                                                  </div>
                                                  <div class="form-group col-md-4 col-md-offset-1">
                                                    <label for="expediteurcontact" class="control-label ">Sender's Phone Number : </label>
                                                    <input type="tel" class="form-control" id="expediteurcontact" name="expediteurcontact" placeholder="Enter the Sender phone number ">
                                                </div>
                                                <div class="form-group col-md-4 col-md-offset-2">
                                                  <label for="receveurnom" class="control-label ">Recipient's Name :</label>
                                                  <input type="text" class="form-control" name="receveurnom" id="receveurnom" placeholder="Entrez le nom du receveur ">
                                               </div>
                                               <div class="form-group col-md-4 col-md-offset-1">
                                                <label for="receveurcontact" class="control-label " >Recipient  Phone Number: </label>
                                                <input type="tel" class="form-control" id="receveurcontact" name="receveurcontact" placeholder="Entrer the Recipient Phone Number">
                                            </div>

                                                    <div class="form-group col-md-4 col-md-offset-1">
                                                      <label for="villedestination" class="control-label ">Recipient Country</label>

                                                       <input id="paysdestination" class="form-control " name="paysdestination" readonly />



                                                       <input type="hidden" id="idclient" class="form-control " name="idclient" />

                                                    </div>
                                                    <div class="form-group col-md-4 col-md-offset-1">
                                                      <label for="montant" class="control-label " >Amount Send: </label>
                                                      <input type="text" class="form-control number-separator"  id="montantaenvoyer"   placeholder="Enter t " readonly>

                                                      <input type="hidden"  id="montant" name="montant"  class="form-control p-3"  required>
                                                    </div>
                                                    <div class="form-group col-md-4 col-md-offset-1">
                                                      <label for="montant" class="control-label " >Shipping : </label>
                                                      <input id="hfrais" name="hfrais" class="form-control number-separator" readonly>
                                                      <input  type="hidden" id="frais" name="frais" class="form-control" readonly>
                                                      <input type="hidden" name="lesfrais" id="lesfrais"   />
                                                    </div>
                                                    <div class="form-group col-md-4 col-md-offset-1">
                                                      <label for="montant" class="control-label " >Amount to be received in currency .<span id="dev"></span> : </label>
                                                      <input id="hlasomme"   name="hmonaieenvoie" class="form-control number-separator" readonly>

                                                      <input type="hidden"  id="lasomme"   name="monaieenvoie" class="form-control" readonly>
                                                    </div>
                                                    <div class="form-group col-md-4 col-md-offset-1">
                                                      <label for="montant" class="control-label " >Amount to be received in local  currency.  <span id="devisereveur"></span> : </label>
                                                      <input id="hmonaierecevoir" name="hmonaierecevoir number-separator" class="form-control" readonly>

                                                      <input type="hidden" id="monaierecevoir" name="monaierecevoir" class="form-control" readonly>
                                                      <input type="hidden" id="fraisdepot" name="fraisdepot" class="form-control" >
                                                      <input type="hidden" id="fraisretrait" name="fraisretrait" class="form-control" >
                                                      <input type="hidden" id="fraisprincipale" name="fraisprincipale" class="form-control" >
                                                    </div>
                                                    <div class="form-group col-md-4 col-md-offset-1">
                                                      <label for="code" class="control-label " >Retreat Code  : </label>
                                                      <input type="text" value=""  class="form-control" id="codet" name="code" placeholder="Entrez le montant a envoyé " readonly>
                                                  </div>
                                                  <div id="carte" class="form-group col-md-4 col-md-offset-1">
                                                    <label for="numerocarte" class="control-label ">Card Number: </label>
                                                    <input type="text"  class="form-control" id="numerocarte" name="numerocarte" placeholder="Entrez le Numero de la carte">
                                                </div>




                                                </div>
                                                <div class="form-group">
                                                  <div class="col-lg-offset-2 col-lg-9">
                                                    <button id="enregistrer" class="btn btn-primary" type="submit">Modify the Information .</button>
                                                    <button id="can" class="btn btn-warning" type="button">Cancel</button>

                                                  </div>
                                                </div>
                                            </form>



                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
      <!--Fin de notification d'erreur-->

            </div>
            <!-- /col-lg-12 -->
          </div>

          <!-- Button trigger modal -->

        <!-- /row -->
      </section>
    </section>
    <!--main content end-->

  </section>
  <!-- js placed at the end of the document so the pages load faster -->

  <script>




    document.querySelector("#factureimprimer").addEventListener("click", ()=>{

        const invoice = this.document.getElementById("factureenvoie");
        var opt = {
margin:       0.1,
filename:     'facturereception.pdf',
image:        { type: 'jpeg', quality: 0.98 },
html2canvas:  { scale: 2 },
jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' },

pagebreak: {mode: 'avoid-all', before:'#pageX'}
};
        html2pdf().from(invoice).set(opt).save();


    })






</script>
<script>
  easyNumberSeparator({
    selector: '.number-separator',
    separator: ' ',
    resultInput: '#montant',
  })
  //

</script>

  <script src="/assets/semantic/lib/bootstrap/js/bootstrap.min.js"></script>


  <script>

    var nomimprimer = "";
    var idtransaction = "";

        $().ready(function() {
          // validate the comment form when it is submitted
          jQuery.validator.addMethod("phoneGuinee", function (phone_number, element) {
            phone_number = phone_number.replace(/\s+/g, "");
            return this.optional(element) || phone_number.length >= 9 && phone_number.match(/^6[1,2,5,6]{1}[0-9]{7}$/);
        }, "Veuillez Entrez le bon format de Numero");
          // validate signup form on keyup and submit
          $("#rectifie").validate({
            rules: {
              code: {
                required: true,
                minlength: 5
              } ,

            },
            messages: {
              code: {
                required: "Veuillez entrez le code .",
                minlength: "Votre code doit  être égale à 5 caractères "
              }
            },
            submitHandler: function(form){

         $.ajax({
             url: form.action,
             type: form.method,
             data: $(form).serialize(),
             success: function(response) {


                  if (response.codeerreurs) {

        $("#codeerreurs").css({
                          display: 'block'
                        });
                        setTimeout(function () {
        $("#codeerreurs").css({
          display: 'none'
        });
        }, 3000)

                    }

                    if (response.transaction) {

                      $("#blockmodifier").css({
          display: 'block'
        });
                    //
                    $("#idtransaction").val(response.transaction['idtransac']);

                    $("#expediteurnom").val(response.transaction['Nomexpediteur']);
                    $("#expediteurcontact").val(response.transaction['Contactexpediteur']);
                    $("#receveurnom").val(response.transaction['Nomreceveur']);

                    $("#idclient").val(response.transaction['idclient']);


                    $("#numerocarte").val(response.transaction['Numerocarte']);
                    $("#receveurcontact").val(response.transaction['Contactreceveur']);
                    var mt = new Intl.NumberFormat('gn-GN').format(response.transaction['Sommeenvoie'])
                    var fr = new Intl.NumberFormat('gn-GN').format(response.transaction['Frais']);
                    var  md = new Intl.NumberFormat('gn-GN').format(response.transaction['montantdevise']);
                    var  ml = new Intl.NumberFormat('gn-GN').format(response.transaction['montantlocale']);

                    $("#montantaenvoyer").val(mt);
                    //frais
                    $("#hfrais").val(fr);
                    $("#hlasomme").val(md);
                    $("#hlasomme").val(md);
                    $("#hmonaierecevoir").val(ml);
                    $("#codet").val(response.transaction['Codetransfert']);
                    //montantenvoie
                    $("#paysdestination").val(response.transaction['pays']);
                    var frais = new Intl.NumberFormat('gn-GN').format(response.frais)








                  }




                            }
               });
         }

          });


          //code to hide topic selection, disable for demo
          var newsletter = $("#newsletter");
          // newsletter topics are optional, hide at first
          var inital = newsletter.is(":checked");
          var topics = $("#newsletter_topics")[inital ? "removeClass" : "addClass"]("gray");
          var topicInputs = topics.find("input").attr("disabled", !inital);
          // show when newsletter is checked
          newsletter.click(function() {
            topics[this.checked ? "removeClass" : "addClass"]("gray");
            topicInputs.attr("disabled", !this.checked);
          });
        });

     document.querySelector("#imprimer").addEventListener("click", ()=>{
                const invoice = this.document.getElementById("lenvoie");

                     //si le compte n'est pas engistrer


                var opt = {
      margin:       0.5,
      filename:     nomimprimer,
      image:        { type: 'jpeg', quality: 0.98 },
      html2canvas:  { scale: 2 },
      jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
    };
    html2pdf().from(invoice).set(opt).save();

            })



        </script>
        <script>


            const toastTrigger = document.getElementById('liveToastBtn')
           const toastLiveExample = document.getElementById('liveToast')
           if (toastTrigger) {
             toastTrigger.addEventListener('click', () => {
               const toast = new bootstrap.Toast(toastLiveExample)

               toast.show()
             })
           }


               $().ready(function() {


           $( "#fermer" ).click(function() {


             $('#facture').modal('show')

           })
                 // validate the comment form when it is submitted
                 jQuery.validator.addMethod("phoneGuinee", function (phone_number, element) {
                   phone_number = phone_number.replace(/\s+/g, "");
                   return this.optional(element) || phone_number.length >= 9 && phone_number.match(/^6[1,2,5,6]{1}[0-9]{7}$/);
               }, "Veuillez Entrez le bon format de Numero");
                 // validate signup form on keyup and submit
                 $("#signu").validate({
                   rules: {
                     expediteurnom: {
                       required: true,
                       minlength: 2
                     } ,
                     expediteurcontact: {
                               required: true,
                               number: true
                           },
                     receveurnom: {
                       required: true,
                       minlength: 2
                     } ,
                     receveurcontact :  {
                               required: true,
                               number: true
                           },
                   },
                   messages: {
                     expediteurnom: {
                       required: "Veuillez entrez le nom de l'Expediteur .",
                       minlength: "Votre nom de l'expediteur doit etre superieur a 2 caractere "
                     },
                     expediteurcontact: {
                       required: "Veuillez fournir un numéro de téléphone",
                       number: "Veuillez inserer un nombre"
                     },
                     receveurnom: {
                       required: "Veuillez entrez le nom du receveur .",
                       minlength: "Votre nom de receveur doit etre superieur a 2 caractere "
                     },
                     receveurcontact: {
                       required: "Veuillez fournir un numéro de téléphone",
                       number: "Veuillez inserer un nombre"
                     }
                   },
                   submitHandler: function(form){

                $.ajax({
                    url: form.action,
                    type: form.method,
                    data: $(form).serialize(),
                    success: function(response) {
                     if(response.valide){
           //Solde Insuffissant

           $('#valide').modal('show')
           setTimeout(function () {
  // /Agence/Rectification

  window.location.href = "/Agence/Rectification";


    }, 2000)

                     }






                                   }
                      });
                }

                 });


                 //code to hide topic selection, disable for demo
                 var newsletter = $("#newsletter");
                 // newsletter topics are optional, hide at first
                 var inital = newsletter.is(":checked");
                 var topics = $("#newsletter_topics")[inital ? "removeClass" : "addClass"]("gray");
                 var topicInputs = topics.find("input").attr("disabled", !inital);
                 // show when newsletter is checked
                 newsletter.click(function() {
                   topics[this.checked ? "removeClass" : "addClass"]("gray");
                   topicInputs.attr("disabled", !this.checked);
                 });
               });
               </script>


  <script class="include" type="text/javascript" src="/assets/semantic/lib/jquery.dcjqaccordion.2.7.js"></script>
  <script src="/assets/semantic/lib/jquery.scrollTo.min.js"></script>
  <script src="/assets/semantic/lib/jquery.nicescroll.js" type="text/javascript"></script>
  <script src="/assets/semantic/lib/jquery.sparkline.js"></script>
  <!--common script for all pages-->
  <script src="/assets/semantic/lib/common-scripts.js"></script>
  <script type="text/javascript" src="/assets/semantic/lib/gritter/js/jquery.gritter.js"></script>
  <script type="text/javascript" src="/assets/semantic/lib/gritter-conf.js"></script>
  <!--script for this page-->



</body>

</html>
